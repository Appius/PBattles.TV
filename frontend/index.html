<html>
    <head>
        <title>Mastrubate.tv</title>
        <script type="text/javascript" src="swfobject/swfobject.js"></script>
        <script type="text/javascript" src="js/jquery.min.js"></script>
        <script type="text/javascript">

            var myself = null;
            var peers = [];

            function getFlashMovie(movieName) {
                var isIE = navigator.appName.indexOf("Microsoft") != -1;
                return (isIE) ? window[movieName] : document[movieName];  
            }

            function onCreationComplete(event) {
            }

            function onPropertyChange(event) {
                if (event.property == "nearID") {
                    if (event.objectID == "my-stream") {
                        $('input[name=' + myself +']').val(event.newValue);
                    }
                }
            }

            $(document).ready(function(){
                    $("input[name='start-stream']").click(function(){
                        myself = $("input[name='myself']:checked").val();
                        getFlashMovie('my-stream').setProperty('src', $('#url1').val() + '?publish=' + myself);
                    });                

                    $("input[name='reset-stream']").click(function(){
                        getFlashMovie('my-stream').setProperty('src', null); 
                    });                

                    $("input[name='view-stream']").click(function(){
                        myself = $("input[name='myself']:checked").val();

                        peers = [];

                        $('.peer-id').each(function(){
                            if($(this).val().length != 0){
                                peers.push([$(this).attr('name'), $(this).val()]);
                            }
                        });

                        $.each(peers, function(index, value){
                            if(value[0] != myself){
                                getFlashMovie('peer'+(index+1)+'-stream').setProperty('src', $('#url1').val() + '?play=' + value[0] + '&farID=' + value[1] );
                            }
                        });
                    });                
            });
        </script>
    </head>
    <body>
        <div style="border: 1px solid;">
            <p>Debug info</p>
            <input id="url1" type="hidden" value="rtmfp://p2p.rtmfp.net/91d6100deca5b227408d88d8-878173b8d137/"/>
            <form name="test-names">
                <input type="radio" value="peer1" name="myself"/>Michael
                <input type="text" autocomplete="off" name="peer1" class="peer-id"/>
                <br />
                <input type="radio" value="peer2" name="myself"/>Nazar
                <input type="text" autocomplete="off" name="peer2" class="peer-id"/>
                <br />
                <input type="radio" value="peer3" name="myself"/>Vlad
                <input type="text" autocomplete="off" name="peer3" class="peer-id"/>
                <br />
                <input type="radio" value="peer4" name="myself"/>Olya
                <input type="text" autocomplete="off" name="peer4" class="peer-id"/>
                <br />
                <input type="radio" value="peer5" name="myself"/>Tolia
                <input type="text" autocomplete="off" name="peer5" class="peer-id"/>
                <br />
                <input name="start-stream" value="start my stream" type="button" />
                <input name="reset-stream" value="reset my stream" type="button" />
                <input name="view-stream" value="show other streams" type="button" />
                <input name="reset-view-stream" value="reset other streams" type="button" />
            </form>
        </div>
        <table style="width: 640px;">
            <tr valign="top">
            <td style="background-color: grey;">
                <p>My stream</p>
                <object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"
                        id="my-stream" width="320" height="240"
                        codebase="http://fpdownload.macromedia.com/get/flashplayer/current/swflash.cab">
                        <param name="movie" value="flash/VideoIO.swf" />
                        <param name="quality" value="high" />
                        <param name="bgcolor" value="#000000" />
                        <param name="allowFullScreen" value="true" />
                        <param name="allowScriptAccess" value="always" />
                        <param name="flashVars" value="controls=false" />
                        <embed src="flash/VideoIO.swf" quality="high" bgcolor="#000000"
                            width="320" height="240" name="my-stream" align="middle"
                            play="true" loop="false" quality="high"
                            allowFullScreen="true"
                            allowScriptAccess="always"
                            flashVars="controls=false"
                            type="application/x-shockwave-flash"
                            pluginspage="http://www.adobe.com/go/getflashplayer">
                        </embed>
                </object>
            </td>
            <td>
                <object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"
                        id="peer1-stream" width="320" height="240"
                        codebase="http://fpdownload.macromedia.com/get/flashplayer/current/swflash.cab">
                        <param name="movie" value="flash/VideoIO.swf" />
                        <param name="quality" value="high" />
                        <param name="bgcolor" value="#000000" />
                        <param name="allowFullScreen" value="true" />
                        <param name="allowScriptAccess" value="always" />
                        <param name="flashVars" value="controls=false" />
                        <embed src="flash/VideoIO.swf" quality="high" bgcolor="#000000"
                            width="320" height="240" name="peer1-stream" align="middle"
                            play="true" loop="false" quality="high"
                            allowFullScreen="true"
                            allowScriptAccess="always"
                            flashVars="controls=false"
                            type="application/x-shockwave-flash"
                            pluginspage="http://www.adobe.com/go/getflashplayer">
                        </embed>
                </object>
            </td>
            <td>
                <object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"
                        id="peer2-stream" width="320" height="240"
                        codebase="http://fpdownload.macromedia.com/get/flashplayer/current/swflash.cab">
                        <param name="movie" value="flash/VideoIO.swf" />
                        <param name="quality" value="high" />
                        <param name="bgcolor" value="#000000" />
                        <param name="allowFullScreen" value="true" />
                        <param name="allowScriptAccess" value="always" />
                        <param name="flashVars" value="controls=false" />
                        <embed src="flash/VideoIO.swf" quality="high" bgcolor="#000000"
                            width="320" height="240" name="peer2-stream" align="middle"
                            play="true" loop="false" quality="high"
                            allowFullScreen="true"
                            allowScriptAccess="always"
                            flashVars="controls=false"
                            type="application/x-shockwave-flash"
                            pluginspage="http://www.adobe.com/go/getflashplayer">
                        </embed>
                </object>
            </td>
        </tr>
    </table>
    </body>
</html>
